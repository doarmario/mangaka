document.addEventListener("DOMContentLoaded",function(){const n=document.getElementById("scrollToggle");const c=document.getElementById("leitor");const o=document.getElementById("changeprev");const e=document.getElementById("changenext");let i=0;let l=pages.length;let t=localStorage.getItem("mode")||"páginas";let s={};let u={};document.getElementById("total-page").innerHTML=l;n.checked=t==="scroll";n.addEventListener("change",function(){t=n.checked?"scroll":"páginas";localStorage.setItem("mode",t);d()});d();o.addEventListener("click",function(){a(-1)});e.addEventListener("click",function(){a(1)});function a(n){document.getElementById("current").innerHTML=i+1;i+=n;if(i<0){i=0}else if(i>=l){i=l-1}w();d();if(i===l-1){f()}}function f(){console.log("Última página carregada, enviando requisição...")}function d(){if(t==="scroll"){g();o.style.display="none";e.style.display="none";window.addEventListener("scroll",r)}else if(t==="páginas"){p();o.style.display="block";e.style.display="block";window.removeEventListener("scroll",r)}}function g(){c.innerHTML="";for(let n=0;n<Math.min(3,l);n++){const o=document.createElement("img");o.src=pages[n];c.appendChild(o);s[n]=true}}function r(){if(window.innerHeight+window.scrollY>=document.body.offsetHeight-600){console.log("Usuário está próximo do final da página");m(2);if(window.innerHeight+window.scrollY>=document.body.offsetHeight-100){f()}}else{w()}}function m(o){let e=i+1;for(let n=0;n<o;n++){while(s[e]){e++}if(e<l){const t=document.createElement("img");t.src=pages[e];c.appendChild(t);s[e]=true;e++}}}function w(){const n=i+1;if(n<l){const o=pages[n];if(!u[o]){const e=new Image;e.src=o;u[o]=true}}}function p(){c.innerHTML="";const n=document.createElement("img");const o=pages[i];if(u[o]){n.src=o;c.appendChild(n)}else{const e=new Image;e.src=o;e.onload=function(){n.src=o;c.appendChild(n);u[o]=true}}w()}});